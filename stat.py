import marimo

__generated_with = "0.18.4"
app = marimo.App(width="medium")


@app.cell
def _():
    import marimo as mo
    import pandas as pd
    import numpy as np
    import matplotlib.pyplot as plt
    import math
    plt.rcParams["font.family"] = "Meiryo"   # Mac ã¯ "Hiragino Sans" æ¨å¥¨
    return math, mo, np, pd, plt


@app.cell
def _(mo):
    mo.md("""
    SSDSEã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ã€ã€Œå‡ºç”Ÿç‡ã€ãŒä½ã„éƒ½é“åºœçœŒã¨ é«˜ã„éƒ½é“åºœçœŒã®é•ã„ã‚’è¦‹å‡ºã—ã€æ–½ç­–æ¤œè¨ã«ç¹‹ã’ã‚‹
    (https://www.nstac.go.jp/use/literacy/ssdse/)
    """)
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md("""
    ã¨ã¦ã‚‚è‰¯ã„ãƒ†ãƒ¼ãƒè¨­å®šã§ã™ã€‚
    ã“ã‚Œã¯ **SSDSEï¼ˆæ•™è‚²ç”¨æ¨™æº–ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼‰**ã®ä¸­ã§ã‚‚ã€Œæ”¿ç­–åˆ†æã®å…¥å£ã€ã¨ã—ã¦ç‹é“ã§ã™ã€‚

    ä»¥ä¸‹ã§ã¯ã€

    * **ã©ã†ã„ã†è¨­è¨ˆã§å·®ã‚’è¦‹å‡ºã™ã‹**
    * **ã©ã“ã¾ã§ãŒçµ±è¨ˆã§è¨€ãˆã¦ã€ã©ã“ã‹ã‚‰ãŒæ–½ç­–æ¤œè¨ã‹**
    * **ã‚„ã£ã¦ã¯ã„ã‘ãªã„è½ã¨ã—ç©´**

    ã‚’ **åˆ†æãƒ•ãƒ¬ãƒ¼ãƒ **ã¨ã—ã¦æ•´ç†ã—ã¾ã™ã€‚
    ï¼ˆâ€»ã¾ã æ•°å€¤åˆ†æã¯ã—ã¾ã›ã‚“ï¼‰

    ---

    ## 0ï¸âƒ£ å¤§å‰æï¼ˆæœ€é‡è¦ï¼‰

    ã“ã®åˆ†æã®ç›®çš„ã¯ï¼š

    > âŒ å‡ºç”Ÿç‡ãŒä½ã„çœŒã‚’ã€Œè©•ä¾¡ã™ã‚‹ã€
    > â­• å‡ºç”Ÿç‡ãŒç•°ãªã‚‹èƒŒæ™¯æ§‹é€ ã‚’ç†è§£ã—ã€**æ”¿ç­–ã®ä»®èª¬ã‚’ä½œã‚‹**

    ã§ã™ã€‚

    **åŸå› ã®æ–­å®šã¯ã§ããªã„**
    â†’ ã—ã‹ã— **æ”¿ç­–ã®è«–ç‚¹ã¯æŠ½å‡ºã§ãã‚‹**

    ---

    ## 1ï¸âƒ£ ç›®çš„å¤‰æ•°ã®æ˜ç¢ºåŒ–

    ### ç›®çš„å¤‰æ•°ï¼ˆYï¼‰

    * **åˆè¨ˆç‰¹æ®Šå‡ºç”Ÿç‡ï¼ˆA4103ï¼‰**

    â€» å‡ºç”Ÿæ•°ï¼ˆA4101ï¼‰ã§ã¯ãƒ€ãƒ¡
    â†’ äººå£è¦æ¨¡ã®å½±éŸ¿ã‚’é™¤ã‘ãªã„ãŸã‚

    ---

    ## 2ï¸âƒ£ éƒ½é“åºœçœŒã‚’ã€Œé«˜å‡ºç”Ÿç‡ç¾¤ï¼ä½å‡ºç”Ÿç‡ç¾¤ã€ã«åˆ†ã‘ã‚‹

    ### æ–¹æ³•ï¼ˆæ¨å¥¨ï¼‰

    * å…¨å›½ä¸­å¤®å€¤ã§2ç¾¤åˆ†å‰²

      * ä¸Šä½50%ï¼šé«˜å‡ºç”Ÿç‡çœŒ
      * ä¸‹ä½50%ï¼šä½å‡ºç”Ÿç‡çœŒ

    ã¾ãŸã¯

    * ä¸Šä½25%ï¼ä¸‹ä½25%ï¼ˆå·®ã‚’å¼·èª¿ï¼‰

    ğŸ‘‰ **ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§ã¯ãªãã€Œç¾¤ã€ã§è¦‹ã‚‹**

    ---

    ## 3ï¸âƒ£ æ¯”è¼ƒè»¸ã®è¨­è¨ˆï¼ˆã“ã“ãŒæ ¸å¿ƒï¼‰

    SSDSEã®é …ç›®ã¯è†¨å¤§ãªã®ã§ã€**æ„å‘³ã®ã‚ã‚‹è»¸ã«æ•´ç†**ã—ã¾ã™ã€‚

    ---

    ### â‘  äººå£æ§‹é€ ãƒ»å®¶æ—æ§‹æˆ

    **ä»®èª¬**
    ã€Œè‹¥å¹´å±¤ãƒ»å®¶æ—å½¢æˆå±¤ãŒå¤šã„åœ°åŸŸã»ã©å‡ºç”Ÿç‡ã¯é«˜ã„ã€

    ä½¿ã†æŒ‡æ¨™ä¾‹ï¼š

    * 15æ­³æœªæº€äººå£æ¯”ç‡ï¼ˆA1301 / A1101ï¼‰
    * 15ï½64æ­³äººå£æ¯”ç‡ï¼ˆA1302 / A1101ï¼‰
    * å˜ç‹¬ä¸–å¸¯æ•°æ¯”ç‡ï¼ˆA710201 / A710101ï¼‰
    * å©šå§»ä»¶æ•°ï¼ˆA9101ï¼‰

    è¦‹ã‚‹ãƒã‚¤ãƒ³ãƒˆï¼š

    * è‹¥å¹´äººå£ãŒå°‘ãªã„ â†’ å‡ºç”Ÿç‡ãŒä½ã„ã®ã¯å½“ç„¶
    * ãã‚Œã‚’ **æ”¿ç­–ã§ã©ã†è£œã†ã‹** ãŒè«–ç‚¹

    ---

    ### â‘¡ çµŒæ¸ˆãƒ»æ‰€å¾—ç’°å¢ƒ

    **ä»®èª¬**
    ã€Œç”Ÿæ´»ã®è¦‹é€šã—ãŒç«‹ã¤åœ°åŸŸã»ã©å‡ºç”Ÿç‡ã¯é«˜ã„ã€

    ä½¿ã†æŒ‡æ¨™ä¾‹ï¼š

    * 1äººå½“ãŸã‚ŠçœŒæ°‘æ‰€å¾—ï¼ˆC122101ï¼‰
    * çœŒå†…ç·ç”Ÿç”£ï¼ˆC1121ï¼‰
    * å¾“æ¥­è€…æ•°æ§‹æˆï¼ˆè£½é€ ãƒ»åŒ»ç™‚ãƒ»æƒ…å ±é€šä¿¡ãªã©ï¼‰

    æ³¨æ„ï¼š

    * æ‰€å¾—ãŒé«˜ã„éƒ½å¸‚éƒ¨ã»ã©å‡ºç”Ÿç‡ãŒä½ã„ã“ã¨ã‚‚å¤šã„
      â†’ **å˜ç´”ãªç›¸é–¢ã¯å±é™º**

    ---

    ### â‘¢ ä½ç’°å¢ƒãƒ»ç”Ÿæ´»ã‚³ã‚¹ãƒˆ

    **ä»®èª¬**
    ã€Œä½å±…ã®ä½™è£•ã¯å­è‚²ã¦ä½™åœ°ã«ç›´çµã™ã‚‹ã€

    ä½¿ã†æŒ‡æ¨™ä¾‹ï¼š

    * æŒã¡å®¶æ•°æ¯”ç‡ï¼ˆH1401 / H1100ï¼‰
    * ä¸€æˆ¸å»ºä½å®…æ•°ï¼ˆH2130ï¼‰
    * 1ä½å®…å½“ãŸã‚Šå»¶ã¹é¢ç©ï¼ˆH5507ï¼‰

    ğŸ‘‰
    éƒ½å¸‚éƒ¨ä½å‡ºç”Ÿç‡ã®**èª¬æ˜åŠ›ãŒé«˜ã„è»¸**

    ---

    ### â‘£ å­è‚²ã¦ãƒ»æ•™è‚²ã‚¤ãƒ³ãƒ•ãƒ©

    **ä»®èª¬**
    ã€Œå­è‚²ã¦ãŒâ€œè¦‹ãˆã‚‹â€åœ°åŸŸã»ã©å‡ºç”Ÿç‡ã¯é«˜ã„ã€

    ä½¿ã†æŒ‡æ¨™ä¾‹ï¼š

    * ä¿è‚²æ‰€ç­‰æ•°ï¼ˆI510120ï¼‰
    * ä¿è‚²æ‰€åœ¨æ‰€å…æ•°ï¼ˆI5102ï¼‰
    * å¹¼ç¨šåœ’ãƒ»å°å­¦æ ¡æ•°ï¼å…ç«¥æ•°
    * åŒ»å¸«æ•°ï¼ˆI6100ï¼‰

    ãƒã‚¤ãƒ³ãƒˆï¼š

    * çµ¶å¯¾æ•°ã§ã¯ãªã **äººå£å½“ãŸã‚ŠæŒ‡æ¨™** ã«å¤‰æ›

    ---

    ### â‘¤ éƒ½å¸‚æ€§ãƒ»æµå‹•æ€§

    **ä»®èª¬**
    ã€ŒäººãŒæµå‹•çš„ãªåœ°åŸŸã»ã©å‡ºç”Ÿã¯å¾Œå›ã—ã«ãªã‚Šã‚„ã™ã„ã€

    ä½¿ã†æŒ‡æ¨™ä¾‹ï¼š

    * è»¢å…¥ãƒ»è»¢å‡ºè€…æ•°ï¼ˆA5101 / A5102ï¼‰
    * å˜ç‹¬ä¸–å¸¯æ¯”ç‡
    * å¤–å›½äººå®¿æ³Šè€…æ•°ï¼ˆG1501ï¼‰

    ---

    ## 4ï¸âƒ£ åˆ†æã§ã€Œè¨€ã£ã¦ã‚ˆã„ã“ã¨ï¼ãƒ€ãƒ¡ãªã“ã¨ã€

    ### âœ… è¨€ã£ã¦ã‚ˆã„ã“ã¨

    * é«˜å‡ºç”Ÿç‡çœŒã§ã¯ã€‡ã€‡ã®å‚¾å‘ãŒå¼·ã„
    * ä½å‡ºç”Ÿç‡çœŒã§ã¯â–³â–³ãŒé¡•è‘—
    * éƒ½å¸‚å‹ãƒ»åœ°æ–¹å‹ã§æ§‹é€ ãŒé•ã†
    * æ”¿ç­–ã®è«–ç‚¹å€™è£œã‚’æç¤º

    ---

    ### âŒ è¨€ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨

    * ã€Œã€‡ã€‡ãŒåŸå› ã§å‡ºç”Ÿç‡ãŒä½ã„ã€
    * ã€Œã“ã‚Œã‚’ã‚„ã‚Œã°å‡ºç”Ÿç‡ãŒä¸ŠãŒã‚‹ã€
    * å› æœã®æ–­å®š

    ---

    ## 5ï¸âƒ£ æ–½ç­–æ¤œè¨ã¸ã®ã¤ãªã’æ–¹ï¼ˆã“ã“ãŒè©•ä¾¡ã•ã‚Œã‚‹ï¼‰

    ### æ‚ªã„ä¾‹

    > æ‰€å¾—ã‚’ä¸Šã’ã‚Œã°å‡ºç”Ÿç‡ãŒä¸ŠãŒã‚‹

    ### è‰¯ã„ä¾‹

    > ä½å‡ºç”Ÿç‡çœŒã§ã¯
    > ãƒ»å˜ç‹¬ä¸–å¸¯æ¯”ç‡ãŒé«˜ã
    > ãƒ»ä½å®…é¢ç©ãŒå°ã•ã
    > ãƒ»è»¢å‡ºå…¥ãŒå¤šã„
    >
    > â†’ **å®¶æ—å½¢æˆã®â€œå®šç€â€ã‚’å¦¨ã’ã‚‹æ§‹é€ ãŒç¤ºå”†ã•ã‚Œã‚‹**

    ğŸ‘‰
    **æ–½ç­–ã¯ã€Œæ•°å€¤ã€ã§ã¯ãªãã€Œæ§‹é€ ã€ã«å‘ã‘ã‚‹**

    ---

    ## 6ï¸âƒ£ SSDSEã‚’ä½¿ã†æ„ç¾©ï¼ˆé‡è¦ï¼‰

    e-Stat / SSDSE ã¯ï¼š

    * æ”¿ç­–æ±ºå®šç”¨ãƒ‡ãƒ¼ã‚¿ âŒ
    * **æ€è€ƒè¨“ç·´ç”¨ãƒ‡ãƒ¼ã‚¿ â­•**

    ã§ã™ã€‚

    ã“ã®é¡Œæã§è©•ä¾¡ã•ã‚Œã‚‹ã®ã¯ï¼š

    * æ•°å¼ã‚„å›å¸°ã§ã¯ãªã
    * **ä»®èª¬ã®ç«‹ã¦æ–¹**
    * **åˆ‡ã‚Šå£ã®å¦¥å½“æ€§**
    * **å› æœã‚’èªã‚‰ãªã„æ…é‡ã•**

    ---

    ## 7ï¸âƒ£ æ¬¡ã«ã‚„ã‚‹ã¨ä¸€æ°—ã«ã€Œåˆ†æã‚‰ã—ããªã‚‹ã€

    ã‚‚ã—ç¶šã‘ã‚‹ãªã‚‰ï¼š

    1. å‡ºç”Ÿç‡ã§2ç¾¤åˆ†å‰²
    2. å„æŒ‡æ¨™ã‚’ **äººå£å½“ãŸã‚Š** ã«å¤‰æ›
    3. ç®±ã²ã’å›³ã§ç¾¤æ¯”è¼ƒ
    4. ã€Œå·®ãŒå¤§ãã„æŒ‡æ¨™ã€ã ã‘æ®‹ã™
    5. æ”¿ç­–è«–ç‚¹ã«ç¿»è¨³

    ---

    å¿…è¦ãªã‚‰æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ï¼š

    * âœ”ï¸ åˆ†æé …ç›®ã‚’10å€‹ã«çµã‚‹
    * âœ”ï¸ å®Ÿéš›ã®åˆ†æã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ä¸€ç·’ã«è¨­è¨ˆ
    * âœ”ï¸ ã€Œè¡Œæ”¿ãƒ¬ãƒãƒ¼ãƒˆé¢¨ã€ã®æ§‹æˆã«è½ã¨ã™

    ã©ã“ã¾ã§ã‚„ã‚ŠãŸã„ã§ã™ã‹ï¼Ÿ
    """)
    return


@app.cell
def _(pd):
    # 1è¡Œç›®ã‚’å…ˆé ­è¡Œã«ã—ã¦èª­ã¿è¾¼ã‚€
    df = pd.read_excel("SSDSE-C-2025.xlsx", header=1)

    # èª­ã¿è¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰å…ˆé ­è¡Œã‚’å‰Šé™¤
    # (å…ˆé ­è¡Œã¯ã€ã€Œå…¨å›½ã€ã«é–¢ã™ã‚‹çµ±è¨ˆãƒ‡ãƒ¼ã‚¿)
    df = df.drop(index=[0]).reset_index(drop=True)

    # åˆ—åã‚’æ–‡å­—åˆ—ã«ã—ã¦ãŠãï¼ˆå®‰å…¨ç­–ï¼‰
    df.columns = df.columns.astype(str)
    cols = ["åœ°åŸŸã‚³ãƒ¼ãƒ‰", "éƒ½é“åºœçœŒ", "å¸‚", "ç‰›è‚‰", "è±šè‚‰", "é¶è‚‰"]
    df = df[cols]
    df.head()
    return (df,)


@app.cell
def _(df):
    df.describe()
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md("""
    çµè«–ã‹ã‚‰è¨€ã†ã¨ã€**ãã®èªè­˜ã¯ã‹ãªã‚Šé•ã£ã¦ã„ã¾ã™**ã€‚
    ç®±ã²ã’å›³ã¯ã€Œå¹³å‡ã€ã‚„ã€Œæœ€å¤§ãƒ»æœ€å°ã€ã‚’**å¿…ãš**ç¤ºã™å›³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

    é †ã« **æ­£ã—ã„å®šç¾©** ã‚’æ•´ç†ã—ã¾ã™ã€‚

    ---

    ## ç®±ã²ã’å›³ã®æ­£ã—ã„èª­ã¿æ–¹ï¼ˆæ¨™æº–ï¼‰

    ### â‘  ç®±ã®ä¸­ã®ç·šï¼ˆä¸­å¤®ç·šï¼‰

    âŒ å…¨ä½“ã®å¹³å‡
    âœ… **ä¸­å¤®å€¤ï¼ˆç¬¬2å››åˆ†ä½æ•°, Q2ï¼‰**

    ---

    ### â‘¡ ç®±ã®ä¸‹ç«¯ãƒ»ä¸Šç«¯

    * ä¸‹ç«¯ï¼š**ç¬¬1å››åˆ†ä½æ•°ï¼ˆQ1ï¼‰**ï¼ˆä¸‹ä½25%ï¼‰
    * ä¸Šç«¯ï¼š**ç¬¬3å››åˆ†ä½æ•°ï¼ˆQ3ï¼‰**ï¼ˆä¸Šä½25%ï¼‰

    ğŸ‘‰ ç®±ã®ä¸­ã«ã¯ **ä¸­å¤®ã®50%ï¼ˆIQRï¼‰** ãŒå…¥ã‚‹

    ---

    ### â‘¢ ç®±ã®ä¸Šä¸‹ã®æ„å‘³

    | éƒ¨åˆ†    | å«ã‚€å‰²åˆ            |
    | ----- | --------------- |
    | ç®±ã®ä¸‹åŠåˆ† | **Q1ã€œä¸­å¤®å€¤ï¼ˆ25%ï¼‰** |
    | ç®±ã®ä¸ŠåŠåˆ† | **ä¸­å¤®å€¤ã€œQ3ï¼ˆ25%ï¼‰** |

    âŒ ä¸Šä½50%ãƒ»ä¸‹ä½50%ã§ã¯ãªã„

    ---

    ### â‘£ ã²ã’ï¼ˆwhiskersï¼‰

    âŒ å…¨ãƒ‡ãƒ¼ã‚¿ã®ç¯„å›²
    âŒ æœ€å¤§å€¤ãƒ»æœ€å°å€¤ã¾ã§å¿…ãšä¼¸ã³ã‚‹

    âœ… **Q1 âˆ’ 1.5Ã—IQR ã€œ Q3 + 1.5Ã—IQR ã®ç¯„å›²å†…ã«ã‚ã‚‹æœ€å°ãƒ»æœ€å¤§å€¤**

    ---

    ### â‘¤ ç‚¹ï¼ˆâ—‹ï¼‰ãŒã‚ã‚‹å ´åˆ

    * ã²ã’ã®å¤–ã«ã‚ã‚‹ç‚¹ â†’ **å¤–ã‚Œå€¤ï¼ˆoutlierï¼‰**
    * æœ€å¤§å€¤ãƒ»æœ€å°å€¤ã¨ã¯é™ã‚‰ãªã„

    ---

    ## æ­£ã—ã„æ§‹é€ ã‚’å›³ã§è¡¨ã™ã¨

    ```
            â—‹  â† å¤–ã‚Œå€¤
            |
       â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€  â† Q3ï¼ˆ75%ï¼‰
            â”‚
            â”‚  â† ä¸Šä½25%
            â”‚
       â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€  â† ä¸­å¤®å€¤ï¼ˆ50%ï¼‰
            â”‚
            â”‚  â† ä¸‹ä½25%
            â”‚
       â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€  â† Q1ï¼ˆ25%ï¼‰
            |
            |
    ```

    ---

    ## ã‚ãªãŸã®èªè­˜ã¨ã®å¯¾å¿œè¡¨

    | é …ç›®   | èªè­˜       | æ­£è§£      |
    | ---- | -------- | ------- |
    | ä¸­å¤®ã®ç·š | å¹³å‡       | âŒ ä¸­å¤®å€¤   |
    | ç®±    | ä¸Šä½ãƒ»ä¸‹ä½50% | âŒ ä¸­å¤®50% |
    | ã²ã’   | æœ€å°ã€œæœ€å¤§    | âŒ IQRåŸºæº– |
    | å¤–ã‚Œå€¤  | ï¼Ÿ        | â—‹ ã§è¡¨ç¤º   |

    ---

    ## ä¾‹å¤–ï¼ˆæ³¨æ„ï¼‰

    ### æœ€å¤§ãƒ»æœ€å°ã¾ã§ä¼¸ã³ã‚‹ç®±ã²ã’å›³ã‚‚å­˜åœ¨ã™ã‚‹

    ```python
    ax.boxplot(data, whis=(0, 100))
    ```

    ã“ã®å ´åˆã®ã¿ï¼š

    * ã²ã’ï¼æœ€å°ã€œæœ€å¤§
    * å¤–ã‚Œå€¤ã¯è¡¨ç¤ºã•ã‚Œãªã„

    ğŸ‘‰ **ãŸã ã—æ¨™æº–ã§ã¯ãªã„**

    ---

    ## ã¾ã¨ã‚ï¼ˆè¶…é‡è¦ï¼‰

    * ç®±ã²ã’å›³ã¯ **ä¸­å¤®å€¤ã¨åˆ†å¸ƒã®åºƒãŒã‚Š**ã‚’è¦‹ã‚‹å›³
    * å¹³å‡ã¯ **åŸå‰‡è¡¨ç¤ºã•ã‚Œãªã„**
    * å¤–ã‚Œå€¤ã‚’ã€Œåˆ†é›¢ã€ã—ã¦è¦‹ã›ã‚‹ã®ãŒæœ¬è³ª

    ---

    ### ä¸€è¨€ã§è¨€ã†ã¨

    > **ç®±ã²ã’å›³ã¯ã€Œä»£è¡¨å€¤ï¼‹ã°ã‚‰ã¤ãï¼‹ç•°å¸¸å€¤ã€ã‚’ä¸€ç›®ã§è¦‹ã‚‹ãŸã‚ã®å›³**

    ã“ã®èª¤è§£ã¯å¤šãã®äººãŒã—ã¾ã™ãŒã€
    ã“ã“ã§æ­£ã—ãä¿®æ­£ã§ããŸã®ã¯ã¨ã¦ã‚‚è‰¯ã„ç†è§£ã§ã™ ğŸ‘
    """)
    return


@app.cell
def _(df, plt):
    # ç®±ã²ã’å›³ç”¨ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆæ•°å€¤åˆ—ã®ã¿ï¼‰
    data = df[["ç‰›è‚‰", "è±šè‚‰", "é¶è‚‰"]]


    # ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯å‘ã‘ï¼šfig, ax ã‚’æ˜ç¤º
    fig_box, ax_box = plt.subplots(figsize=(8, 5))

    ax_box.boxplot(
        data.values,
        tick_labels=data.columns,
        showfliers=True
    )

    ax_box.set_title("éƒ½é“åºœçœŒåºæ‰€åœ¨å¸‚åˆ¥ å®¶è¨ˆæ¶ˆè²»ï¼ˆç®±ã²ã’å›³ï¼‰")
    ax_box.set_ylabel("æ¶ˆè²»é¡")
    ax_box.grid(axis="y", linestyle="--", alpha=0.6)

    plt.show()
    return


@app.cell
def _(df, plt):
    data_ = df[["ç‰›è‚‰", "è±šè‚‰", "é¶è‚‰"]]

    fig_hist, ax_hist = plt.subplots(figsize=(8, 5))

    ax_hist.hist(data_["ç‰›è‚‰"], bins=12, alpha=0.6, label="ç‰›è‚‰")
    ax_hist.hist(data_["è±šè‚‰"], bins=12, alpha=0.6, label="è±šè‚‰")
    ax_hist.hist(data_["é¶è‚‰"], bins=12, alpha=0.6, label="é¶è‚‰")

    ax_hist.set_xlabel("æ¶ˆè²»é¡")
    ax_hist.set_ylabel("åº¦æ•°")
    ax_hist.set_title("é£Ÿè‚‰åˆ¥ å®¶è¨ˆæ¶ˆè²»ã®åº¦æ•°åˆ†å¸ƒ")
    ax_hist.legend()
    ax_hist.grid(axis="y", linestyle="--", alpha=0.6)

    plt.show()
    return


@app.cell
def _(df, plt):
    fig_hist_2, axes_hist_2 = plt.subplots(1, 3, figsize=(12,4), sharey=True)

    axes_hist_2[0].hist(df["ç‰›è‚‰"], bins=10)
    axes_hist_2[0].set_title("ç‰›è‚‰")

    axes_hist_2[1].hist(df["è±šè‚‰"], bins=10)
    axes_hist_2[1].set_title("è±šè‚‰")

    axes_hist_2[2].hist(df["é¶è‚‰"], bins=10)
    axes_hist_2[2].set_title("é¶è‚‰")

    plt.show()
    return


@app.cell
def _(df):
    pref_df = df.groupby("éƒ½é“åºœçœŒ")[["ç‰›è‚‰","è±šè‚‰","é¶è‚‰"]].mean()

    ratio = pref_df.div(pref_df.sum(axis=1), axis=0)

    ratio.plot(
        kind="bar",
        stacked=True,
        figsize=(12,6)
    )
    return (ratio,)


@app.cell
def _(np, plt, ratio):
    labels = ["ç‰›è‚‰", "è±šè‚‰", "é¶è‚‰"]
    angles = np.linspace(0, 2 * np.pi, len(labels), endpoint=False)
    angles = np.concatenate([angles, [angles[0]]])  # å††ã‚’é–‰ã˜ã‚‹

    n_cols = 6
    prefs = ratio.index.tolist()
    n_rows = int(np.ceil(len(prefs) / n_cols))

    fig_1, axes_1 = plt.subplots(
        n_rows, n_cols,
        subplot_kw=dict(polar=True),
        figsize=(n_cols * 2.2, n_rows * 2.2)
    )

    axes_1 = axes_1.flatten()

    for ax, pref in zip(axes_1, prefs):
        values = ratio.loc[pref].values
        values = np.concatenate([values, [values[0]]])

        ax.plot(angles, values)
        ax.fill(angles, values, alpha=0.3)

        ax.set_title(pref, fontsize=9)
        ax.set_thetagrids(angles[:-1] * 180 / np.pi, labels)
        ax.set_ylim(0, 1)
        ax.set_yticklabels([])

    # ä½™ã£ãŸ axes ã‚’æ¶ˆã™
    for ax in axes_1[len(prefs):]:
        ax.axis("off")

    plt.tight_layout()
    plt.show()
    return (ax,)


@app.cell
def _(df, pd):
    # æ•°å€¤å‹ã«å¤‰æ›ï¼ˆå®‰å…¨ç­–ï¼‰
    meat_cols = ["ç‰›è‚‰", "è±šè‚‰", "é¶è‚‰"]
    df[meat_cols] = df[meat_cols].apply(pd.to_numeric, errors="coerce")

    # ç›¸é–¢ä¿‚æ•°è¡Œåˆ—
    corr = df[meat_cols].corr()
    corr
    return corr, meat_cols


@app.cell
def _(df, plt):
    fig_corr_1, axes_corr_1 = plt.subplots(1, 3, figsize=(12, 4))

    pairs = [("ç‰›è‚‰", "è±šè‚‰"), ("ç‰›è‚‰", "é¶è‚‰"), ("è±šè‚‰", "é¶è‚‰")]

    for ax_, (x, y) in zip(axes_corr_1, pairs):
        # æ•£å¸ƒå›³
        ax_.scatter(df[x], df[y], alpha=0.7)

        # ç›¸é–¢ä¿‚æ•°ï¼ˆPearsonï¼‰
        r = df[[x, y]].corr().iloc[0, 1]

        # è»¸ãƒ©ãƒ™ãƒ«
        ax_.set_xlabel(x)
        ax_.set_ylabel(y)

        # ã‚¿ã‚¤ãƒˆãƒ«ã«ç›¸é–¢ä¿‚æ•°ã‚’è¡¨ç¤º
        ax_.set_title(f"{x} Ã— {y} (r = {r:.2f})")

    plt.tight_layout()
    plt.show()
    return


@app.cell
def _(ax, corr, meat_cols, np, plt):
    fig_corr_2, ax_corr_2 = plt.subplots(figsize=(5, 4))

    im = ax_corr_2.imshow(corr.values, vmin=-1, vmax=1)

    # è»¸ãƒ©ãƒ™ãƒ«
    ax_corr_2.set_xticks(np.arange(len(meat_cols)))
    ax_corr_2.set_yticks(np.arange(len(meat_cols)))
    ax_corr_2.set_xticklabels(meat_cols)
    ax_corr_2.set_yticklabels(meat_cols)

    # å€¤ã‚’ã‚»ãƒ«å†…ã«è¡¨ç¤º
    for i in range(len(meat_cols)):
        for j in range(len(meat_cols)):
            ax.text(
                j, i, f"{corr.iloc[i, j]:.2f}",
                ha="center", va="center", color="black"
            )

    ax_corr_2.set_title("ç”Ÿé®®è‚‰3å“ç›®ã®ç›¸é–¢ä¿‚æ•°")
    fig_corr_2.colorbar(im, ax=ax)

    plt.tight_layout()
    plt.show()
    return


@app.cell
def _(mo):
    mo.md("""
    5äººã§ãƒ†ã‚¹ãƒˆã‚’å—ã‘ãŸãƒ‡ãƒ¼ã‚¿ã‚’è€ƒãˆã‚‹ã€‚

    $X$: å›½èªã®ç‚¹æ•°ï¼Œ

    $Y$ :æ•°å­¦ã®ç‚¹æ•°ã€‚

    å„ã€…ã®å¾—ç‚¹ã¯æ¬¡ã®é€šã‚Šã¨ã™ã‚‹ï¼ˆæº€ç‚¹100ç‚¹ï¼‰ã€‚

    | ç”Ÿå¾’ | å›½èª | æ•°å­¦ |
    |---:|---:|---:|
    | A | 50 | 50 |
    | B | 50 | 70 |
    | C | 80 | 60 |
    | D | 70 | 90 |
    | E | 90 |100 |
    ã“ã®ã¨ãã®å…±åˆ†æ•£ã‚’è¨ˆç®—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    ### å¹³å‡

    $$
    \mu = \frac{1}{N}\sum_{i=1}^N x_i
    $$

    ### åˆ†æ•£

    $$
    \sigma^2 = \frac{1}{N}\sum_{i=1}^N (x_i - \mu)^2
    $$

    ### å…±åˆ†æ•£ï¼ˆæ¯å…±åˆ†æ•£ï¼‰

    $$
    \mathrm{Cov}(X,Y)
    = \frac{1}{N}\sum_{i=1}^N (x_i-\mu_x)(y_i-\mu_y)
    $$

    ### ç›¸é–¢ä¿‚æ•°

    $$
    \rho
    = \frac{\mathrm{Cov}(X,Y)}
    {\sqrt{\mathrm{Var}(X)\mathrm{Var}(Y)}}
    $$

    ### å…±åˆ†æ•£è¡Œåˆ—

    $$
    \Sigma =
    \begin{pmatrix}
    \mathrm{Cov}(X_1,X_1) & \mathrm{Cov}(X_1,X_2) & \cdots \\\\
    \mathrm{Cov}(X_2,X_1) & \mathrm{Cov}(X_2,X_2) & \cdots \\\\
    \vdots & \vdots & \ddots
    \end{pmatrix}
    $$
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    ### ç›¸é–¢è¡Œåˆ—

    ç›¸é–¢ä¿‚æ•° $\rho_{ij}$ ã‚’æˆåˆ†ã¨ã™ã‚‹è¡Œåˆ—ã‚’ **ç›¸é–¢è¡Œåˆ—** ã¨ã„ã†ã€‚

    $$
    \rho_{ij}
    = \frac{\mathrm{Cov}(X_i, X_j)}
    {\sqrt{\mathrm{Var}(X_i)\mathrm{Var}(X_j)}}
    $$

    $$
    R =
    \begin{pmatrix}
    1 & \rho_{12} & \cdots \\\\
    \rho_{21} & 1 & \cdots \\\\
    \vdots & \vdots & \ddots
    \end{pmatrix}
    $$

    ç›¸é–¢è¡Œåˆ—ã¯ã€å…±åˆ†æ•£è¡Œåˆ— $\Sigma$ ã‚’ç”¨ã„ã¦æ¬¡ã®ã‚ˆã†ã«è¡¨ã›ã‚‹ã€‚

    $$
    R = D^{-1/2} \Sigma D^{-1/2}
    $$

    ã“ã“ã§ $D$ ã¯åˆ†æ•£ã®ã¿ã‚’ä¸¦ã¹ãŸå¯¾è§’è¡Œåˆ—ã§ã‚ã‚‹ã€‚

    ---

    ### æ¨™æº–åŒ–ï¼ˆZã‚¹ã‚³ã‚¢ï¼‰

    å„ãƒ‡ãƒ¼ã‚¿ $x_i$ ã‚’å¹³å‡ $\mu$ã€æ¨™æº–åå·® $\sigma$ ã‚’ç”¨ã„ã¦æ¬¡ã®ã‚ˆã†ã«å¤‰æ›ã™ã‚‹ã€‚

    $$
    z_i = \frac{x_i - \mu}{\sigma}
    $$

    æ¨™æº–åŒ–å¾Œã®ãƒ‡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®æ€§è³ªã‚’æŒã¤ã€‚

    - å¹³å‡ï¼š$0$
    - åˆ†æ•£ï¼š$1$
    - å˜ä½ã‚’æŒãŸãªã„

    ---

    ### æ¨™æº–åŒ–ã®è¡Œåˆ—è¡¨ç¾

    å…ƒãƒ‡ãƒ¼ã‚¿è¡Œåˆ—ã‚’

    $$
    X =
    \begin{pmatrix}
    x_{11} & x_{12} & \cdots & x_{1p} \\\\
    x_{21} & x_{22} & \cdots & x_{2p} \\\\
    \vdots & \vdots & & \vdots \\\\
    x_{N1} & x_{N2} & \cdots & x_{Np}
    \end{pmatrix}
    $$

    ã¨ã™ã‚‹ã¨ã€æ¨™æº–åŒ–å¾Œã®ãƒ‡ãƒ¼ã‚¿è¡Œåˆ— $Z$ ã¯

    $$
    Z = (X - \mu)\Sigma^{-1/2}
    $$

    ã¨è¡¨ã•ã‚Œã‚‹ã€‚

    ---

    ### PCAï¼ˆä¸»æˆåˆ†åˆ†æï¼‰

    æ¨™æº–åŒ–å¾Œã®ãƒ‡ãƒ¼ã‚¿ $Z$ ã‹ã‚‰å…±åˆ†æ•£è¡Œåˆ—ï¼ˆã¾ãŸã¯ç›¸é–¢è¡Œåˆ—ï¼‰ã‚’è¨ˆç®—ã™ã‚‹ã€‚

    $$
    S = \frac{1}{N} Z^\top Z
    $$

    æ¬¡ã«ã€ä»¥ä¸‹ã®å›ºæœ‰å€¤å•é¡Œã‚’è§£ãã€‚

    $$
    S \mathbf{v} = \lambda \mathbf{v}
    $$

    - $\lambda$ï¼šä¸»æˆåˆ†ã®åˆ†æ•£ï¼ˆæƒ…å ±é‡ï¼‰
    - $\mathbf{v}$ï¼šä¸»æˆåˆ†æ–¹å‘ï¼ˆå›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ï¼‰

    ---

    ### ä¸»æˆåˆ†å¾—ç‚¹

    ç¬¬ $k$ ä¸»æˆåˆ†ã®å¾—ç‚¹ã¯æ¬¡ã§ä¸ãˆã‚‰ã‚Œã‚‹ã€‚

    $$
    \mathrm{PC}_k = Z \mathbf{v}_k
    $$

    ã“ã‚Œã«ã‚ˆã‚Šã€å¤šå¤‰é‡ãƒ‡ãƒ¼ã‚¿ã‚’å°‘æ•°ã®è»¸ã§è¡¨ç¾ã§ãã‚‹ã€‚
    """)
    return


@app.cell
def _(math):
    def mean(xs):
        '''
        å¹³å‡ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
        '''
        return sum(xs) / len(xs)

    def variance(xs):
        '''
        åˆ†æ•£ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
        '''
        mu = mean(xs)
        return sum((x - mu) ** 2 for x in xs) / len(xs)

    def covariance(xs, ys):
        '''
        å…±åˆ†æ•£ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
        '''
        mu_x = mean(xs)
        mu_y = mean(ys)
        return sum(
            (x - mu_x) * (y - mu_y)
            for x, y in zip(xs, ys)
        ) / len(xs)

    def correlation(xs, ys):
        '''
        ç›¸é–¢ä¿‚æ•°
        '''
        return covariance(xs, ys) / math.sqrt(
            variance(xs) * variance(ys)
        )

    def covariance_matrix(data_dict):
        '''
        å…±åˆ†æ•£è¡Œåˆ—
        '''
        subjects = list(data_dict.keys())
        matrix = []

        for subj_i in subjects:
            row = []
            for subj_j in subjects:
                cov_ij = covariance(
                    data_dict[subj_i],
                    data_dict[subj_j]
                )
                row.append(cov_ij)
            matrix.append(row)

        return subjects, matrix

    return correlation, covariance, covariance_matrix, mean, variance


@app.cell
def _(correlation, covariance, mean, variance):
    # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã—ã§ã€å¹³å‡ã€åˆ†æ•£ã€å…±åˆ†æ•£ã€ç›¸é–¢ä¿‚æ•°ã‚’æ±‚ã‚ã‚‹
    scores_jp = [50, 50, 80, 70, 90]
    scores_math = [50, 70, 60, 90, 100]

    mu_jp = mean(scores_jp)
    mu_math = mean(scores_math)

    var_jp = variance(scores_jp)
    var_math = variance(scores_math)

    cov_jp_math = covariance(scores_jp, scores_math)
    corr_jp_math = correlation(scores_jp, scores_math)

    mu_jp, mu_math, var_jp, var_math, cov_jp_math, corr_jp_math
    return scores_jp, scores_math


@app.cell
def _(np, scores_jp, scores_math):
    # NumPyã§å¹³å‡ã€åˆ†æ•£ã€å…±åˆ†æ•£ã€ç›¸é–¢ä¿‚æ•°ã‚’æ±‚ã‚ã‚‹
    np_jp = np.array(scores_jp)
    np_math = np.array(scores_math)

    np_jp_mu = np_jp.mean()
    np_jp_var = np_jp.var()           # æ¯åˆ†æ•£
    np_math_mu = np_math.mean()
    np_math_var = np_math.var()           # æ¯åˆ†æ•£
    np_cov = np.cov(np_jp, np_math)   # æ¨™æœ¬å…±åˆ†æ•£ï¼ˆN-1ï¼‰
    np_corr = np.corrcoef(np_jp, np_math)
    np_jp_mu, np_math_mu, np_jp_var, np_math_var, np_cov, np_corr
    return


@app.cell
def _(covariance_matrix):
    # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã—ã§å…±åˆ†æ•£è¡Œåˆ—è¨ˆç®—
    scores = {
        "å›½èª": [50, 50, 80, 70, 90],
        "æ•°å­¦": [50, 70, 60, 90, 100],
        "è‹±èª": [60, 65, 70, 85, 95],
        "ç†ç§‘": [55, 60, 75, 80, 90],
        "ç¤¾ä¼š": [58, 62, 78, 82, 88],
    }

    subjects, cov_mat = covariance_matrix(scores)

    subjects, cov_mat
    return cov_mat, scores, subjects


@app.cell
def _(correlation, scores, subjects):
    # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã—ã§ç›¸é–¢è¡Œåˆ—è¨ˆç®—
    n = len(subjects)

    corr_matrix = [[0.0]*n for _ in range(n)]

    for i_, si in enumerate(subjects):
        for j_, sj in enumerate(subjects):
            corr_matrix[i_][j_] = correlation(scores[si], scores[sj])

    corr_matrix
    return (corr_matrix,)


@app.cell
def _(cov_mat, pd, subjects):
    score_df_cov = pd.DataFrame(cov_mat, index=subjects, columns=subjects)
    score_df_cov
    return


@app.cell
def _(corr_matrix, pd, subjects):
    score_df_corr = pd.DataFrame(corr_matrix, index=subjects, columns=subjects)
    score_df_corr
    return


@app.cell
def _():
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md("""
    ### ã‚¯ãƒ©ã‚¹ã®5æ•™ç§‘æˆç¸¾ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ

    ã‚ã‚‹ã‚¯ãƒ©ã‚¹ã§ **5äººã®ç”Ÿå¾’** ãŒ
    **5æ•™ç§‘ï¼ˆå›½èªãƒ»æ•°å­¦ãƒ»è‹±èªãƒ»ç†ç§‘ãƒ»ç¤¾ä¼šï¼‰** ã®ãƒ†ã‚¹ãƒˆã‚’å—ã‘ãŸã€‚

    å„ç”Ÿå¾’ã®å¾—ç‚¹ã¯æ¬¡ã®é€šã‚Šã¨ã™ã‚‹ï¼ˆæº€ç‚¹100ç‚¹ï¼‰ã€‚

    | ç”Ÿå¾’ | å›½èª | æ•°å­¦ | è‹±èª | ç†ç§‘ | ç¤¾ä¼š |
    |---|---:|---:|---:|---:|---:|
    | A | 50 | 50 | 55 | 60 | 58 |
    | B | 50 | 70 | 65 | 68 | 62 |
    | C | 80 | 60 | 78 | 75 | 70 |
    | D | 70 | 90 | 85 | 88 | 82 |
    | E | 90 |100 | 92 | 95 | 90 |

    ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ã€å„æ•™ç§‘ã® **å¹³å‡ãƒ»åˆ†æ•£ãƒ»å…±åˆ†æ•£ãƒ»ç›¸é–¢** ã‚’èª¿ã¹ã‚‹ã€‚

    #### å•1
    å„æ•™ç§‘ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã‚’æ±‚ã‚ã‚ˆã€‚

    - å¹³å‡ç‚¹
    - åˆ†æ•£
    - æ¨™æº–åå·®

    #### å•2
    å›½èªã¨æ•°å­¦ã«ã¤ã„ã¦ã€

    - å…±åˆ†æ•£ã‚’è¨ˆç®—ã›ã‚ˆ
    - å…±åˆ†æ•£ã®ç¬¦å·ã‹ã‚‰ã€ã©ã®ã‚ˆã†ãªé–¢ä¿‚ãŒã‚ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã‚‹ã‹è¿°ã¹ã‚ˆ

    #### å•3
    5æ•™ç§‘ã™ã¹ã¦ã«ã¤ã„ã¦ã€å…±åˆ†æ•£è¡Œåˆ—ã‚’æ±‚ã‚ã‚ˆã€‚

    - å¯¾è§’æˆåˆ†ã¯ä½•ã‚’è¡¨ã—ã¦ã„ã‚‹ã‹
    - éå¯¾è§’æˆåˆ†ã¯ä½•ã‚’è¡¨ã—ã¦ã„ã‚‹ã‹

    #### å•4
    å…±åˆ†æ•£è¡Œåˆ—ã‚’ã‚‚ã¨ã«ã€ç›¸é–¢è¡Œåˆ—ã‚’æ±‚ã‚ã‚ˆã€‚

    - æ•°å­¦ã¨ç†ç§‘ã®ç›¸é–¢ã¯é«˜ã„ã‹ï¼Ÿ
    - å›½èªã¨æ•°å­¦ã®ç›¸é–¢ã¨æ¯”ã¹ã¦ã©ã†ã‹ï¼Ÿ

    #### ç™ºå±•
    å…±åˆ†æ•£è¡Œåˆ—ã‚’ Î£ ã¨ã™ã‚‹ã€‚

    1. Î£ ã®å¯¾è§’æˆåˆ†ãŒåˆ†æ•£ã«ãªã‚‹ç†ç”±ã‚’èª¬æ˜ã›ã‚ˆ
    2. å…±åˆ†æ•£è¡Œåˆ—ãŒå¯¾ç§°è¡Œåˆ—ã«ãªã‚‹ç†ç”±ã‚’èª¬æ˜ã›ã‚ˆ
    3. æˆç¸¾ãŒã™ã¹ã¦åŒã˜ç”Ÿå¾’ã—ã‹ã„ãªã„å ´åˆã€å…±åˆ†æ•£è¡Œåˆ—ã¯ã©ã†ãªã‚‹ã‹ï¼Ÿ
    """)
    return


@app.cell
def _(pd):
    score_data = {
        "å›½èª": [50, 50, 80, 70, 90],
        "æ•°å­¦": [50, 70, 60, 90,100],
        "è‹±èª": [55, 65, 78, 85, 92],
        "ç†ç§‘": [60, 68, 75, 88, 95],
        "ç¤¾ä¼š": [58, 62, 70, 82, 90],
    }

    score_df = pd.DataFrame(score_data, index=["A","B","C","D","E"])
    score_df
    return (score_df,)


@app.cell
def _(score_df):
    # åŸºæœ¬çµ±è¨ˆé‡
    score_df.describe()
    return


@app.cell
def _(score_df):
    # å…±åˆ†æ•£è¡Œåˆ—
    score_cov_matrix = score_df.cov()
    score_cov_matrix
    return


@app.cell
def _(score_df):
    # ç›¸é–¢è¡Œåˆ—
    score_corr_matrix = score_df.corr()
    score_corr_matrix
    return


if __name__ == "__main__":
    app.run()
